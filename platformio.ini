[platformio]
default_envs = esp32c3

[env:esp32c3]
platform = espressif32
board = esp32-c3-devkitm-1
framework = arduino

; Configuración de compilación
board_build.mcu = esp32c3
board_build.f_cpu = 160000000L
board_build.f_flash = 80000000L
board_build.flash_mode = dio

; Tamaño de particiones
board_build.partitions = default.csv
board_upload.flash_size = 4MB

; Puerto serial (ajustar según tu sistema)
; Windows: COMx
; Linux: /dev/ttyUSBx o /dev/ttyACMx
; Mac: /dev/cu.usbserial-xxx
upload_port = /dev/ttyUSB0
monitor_port = /dev/ttyUSB0
monitor_speed = 115200

; Opciones del monitor serial
monitor_filters = 
    esp32_exception_decoder
    colorize
    time

; Flags de compilación
build_flags = 
    -DCORE_DEBUG_LEVEL=0
    -DBOARD_HAS_PSRAM=0
    -DARDUINO_USB_MODE=1
    -DARDUINO_USB_CDC_ON_BOOT=1
    ; Optimizaciones
    -O2
    -ffunction-sections
    -fdata-sections
    ; Configuración WiFi (comentar para usar valores del código)
    ; -DWIFI_SSID=\"TuWiFi\"
    ; -DWIFI_PASSWORD=\"TuPassword\"

; Librerías necesarias (ya incluidas en el core ESP32)
lib_deps = 

; Configuración de depuración
debug_tool = esp-builtin
debug_init_break = tbreak setup

; Entorno para debugging
[env:esp32c3-debug]
extends = env:esp32c3
build_type = debug
build_flags = 
    ${env:esp32c3.build_flags}
    -DCORE_DEBUG_LEVEL=5
    -DDEBUG_ESP_PORT=Serial
monitor_filters = 
    esp32_exception_decoder
    colorize
    time
    log2file

; Entorno de producción optimizado
[env:esp32c3-release]
extends = env:esp32c3
build_type = release
build_flags = 
    ${env:esp32c3.build_flags}
    -DCORE_DEBUG_LEVEL=0
    -Os
    -flto

; Configuración de OTA (Over The Air updates)
[env:esp32c3-ota]
extends = env:esp32c3
upload_protocol = espota
upload_port = esp32-oscilloscope.local
; O usa la IP directamente:
; upload_port = 192.168.1.100
upload_flags = 
    --port=3232
    --auth=admin
